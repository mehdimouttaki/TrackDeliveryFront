<div class="p-6 bg-white rounded shadow">
  <h2 class="text-2xl font-bold mb-4">Orders</h2>

  <div class="flex gap-4 mb-6">
    <input
      type="text"
      placeholder="Search by description"
      [(ngModel)]="filterDescription"
      (input)="applyFilters()"
      class="flex-1 border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-600"
    />
    <input
      type="text"
      placeholder="Search by source"
      [(ngModel)]="filterSource"
      (input)="applyFilters()"
      class="flex-1 border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-600"
    />
    <input
      type="date"
      [(ngModel)]="filterDate"
      (input)="applyFilters()"
      class="flex-1 border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-600"
    />
  </div>

  <div *ngIf="loading" class="text-blue-500">Loading orders...</div>
  <div *ngIf="error" class="text-red-500">{{ error }}</div>

  <table class="min-w-full border border-gray-300" *ngIf="!loading && !error && filteredOrders.length">
    <thead class="bg-gray-100">
    <tr>
      <th class="border px-4 py-2">...</th>
      <th (click)="sortBy('id')" class="cursor-pointer border px-4 py-2">ID</th>
      <th (click)="sortBy('description')" class="cursor-pointer border px-4 py-2">Description</th>
      <th (click)="sortBy('source')" class="cursor-pointer border px-4 py-2">Source</th>
      <th (click)="sortBy('address')" class="cursor-pointer border px-4 py-2">Address</th>
      <th (click)="sortBy('dateOrder')" class="cursor-pointer border px-4 py-2">Date</th>
      <th (click)="sortBy('state')" class="cursor-pointer border px-4 py-2">State</th>
      <th (click)="sortBy('orderNumber')" class="cursor-pointer border px-4 py-2">Order Number</th>
      <th (click)="sortBy('client')" class="cursor-pointer border px-4 py-2">Client</th>
      <th class="border px-4 py-2 text-center">Canceled</th>
      <th class="border px-4 py-2 text-center">Active</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let order of filteredOrders" class="relative">
      <!-- Dots menu -->
      <td class="border px-4 py-2 text-center relative">
        <ng-container *ngIf="!['READY', 'DELAYED', 'DELIVERING', 'DELIVERED'].includes(order.state)">
          <button (click)="toggleDropdown(order.id)" class="text-gray-600 hover:text-black focus:outline-none">
            &#8942;
          </button>
          <div
            *ngIf="selectedOrderId === order.id"
            class="absolute z-10 mt-2 w-28 bg-white border border-gray-300 rounded shadow-lg right-0"
          >
            <button
              (click)="editOrder(order)"
              class="block w-full text-left px-4 py-2 text-sm hover:bg-gray-100 text-gray-700"
            >
              Modifier
            </button>
          </div>
        </ng-container>
      </td>

      <td class="border px-4 py-2">{{ order.id }}</td>
      <td class="border px-4 py-2">{{ order.description }}</td>
      <td class="border px-4 py-2">{{ order.source }}</td>
      <td class="border px-4 py-2">{{ order.address }}</td>
      <td class="border px-4 py-2">{{ order.dateOrder | date: 'short' }}</td>
      <td class="border px-4 py-2">{{ order.state }}</td>
      <td class="border px-4 py-2">{{ order.orderNumber }}</td>
      <td class="border px-4 py-2">{{ order.client.firstName }} {{ order.client.lastName }}</td>

      <td class="border px-4 py-2 text-center">
          <span *ngIf="!order.canceled; else canceledIcon" class="text-green-600" title="Not Canceled">
            ✔️
          </span>
        <ng-template #canceledIcon>
          <span class="text-red-600" title="Canceled">❌</span>
        </ng-template>
      </td>

      <td class="border px-4 py-2 text-center">
        <span *ngIf="order.active; else inactiveIcon" class="text-green-600" title="Active">✔️</span>
        <ng-template #inactiveIcon>
          <span class="text-red-600" title="Inactive">❌</span>
        </ng-template>
      </td>
    </tr>
    </tbody>
  </table>

  <div class="flex justify-center items-center gap-3 mt-4">
    <button
      class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50"
      (click)="changePage(currentPage - 1)"
      [disabled]="currentPage === 1"
    >
      Prev
    </button>

    <span *ngIf="filteredOrders.length > 0" class="font-semibold">
      Results: {{ filteredOrders.length }}
    </span>

    <button
      class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 disabled:opacity-50"
      (click)="changePage(currentPage + 1)"
      [disabled]="currentPage === totalPages"
    >
      Next
    </button>
  </div>
</div>
